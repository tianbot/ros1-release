# RViz插件UI使用说明

## 概述

ros_map_edit RViz插件现在支持两种地图来源：
- **本地地图**: 从本地文件系统选择地图文件
- **远程地图**: 从FTP服务器下载地图文件

## 界面介绍

插件面板包含两个主要选项卡：

### 1. 本地地图选项卡

- **选择本地地图文件**: 点击按钮打开文件对话框
- **支持格式**: 
  - YAML配置文件 (*.yaml, *.yml)
  - PGM图像文件 (*.pgm)
- **功能**: 自动加载对应的虚拟墙和区域文件

### 2. 远程地图选项卡 (FTP)

#### FTP服务器配置
- **服务器**: FTP服务器IP地址 (例如: 192.168.1.100)
- **端口**: FTP端口号 (默认: 21)
- **用户名**: FTP登录用户名
- **密码**: FTP登录密码
- **目录**: 远程地图文件目录 (例如: /maps)

#### 操作步骤
1. **配置FTP连接**: 填写服务器信息
2. **测试连接**: 点击"测试连接"按钮验证配置
3. **刷新文件列表**: 连接成功后自动或手动刷新文件列表
4. **选择文件**: 从文件列表中选择要下载的地图文件
5. **下载并打开**: 点击"下载并打开所选地图"

## 使用示例

### 本地地图使用
```
1. 切换到"本地地图"选项卡
2. 点击"选择本地地图文件"
3. 浏览并选择地图文件 (如: map.yaml)
4. 地图会自动加载到RViz中
5. 对应的虚拟墙文件 (map.json) 和区域文件 (map_region.json) 会自动加载
```

### 远程地图使用
```
1. 切换到"远程地图 (FTP)"选项卡
2. 配置FTP服务器信息:
   - 服务器: 192.168.1.100
   - 端口: 21
   - 用户名: admin
   - 密码: admin123
   - 目录: /maps
3. 点击"测试连接"
4. 连接成功后，从文件列表选择地图文件
5. 点击"下载并打开所选地图"
6. 地图会下载到临时目录并加载到RViz中
7. 对应的虚拟墙和区域文件也会自动下载和加载
```

## 状态指示

### 连接状态
- **未连接**: 红色文字，尚未建立FTP连接
- **正在测试连接**: 橙色文字，正在验证FTP配置
- **连接成功**: 绿色文字，FTP连接建立成功
- **连接失败**: 红色文字，显示错误信息

### 当前地图显示
- **本地地图**: 显示文件名
- **远程地图**: 显示文件名 + "(远程)"标识

### 下载进度
- 下载远程地图时会显示进度条
- 下载完成后自动隐藏

## 文件管理功能

### 一键保存
- 保存当前编辑的地图文件 (YAML + PGM)
- 保存虚拟墙文件 (JSON)
- 保存区域文件 (JSON)

### 自动文件关联
- 加载地图时自动寻找同名的虚拟墙和区域文件
- 虚拟墙文件命名: `map.json`
- 区域文件命名: `map_region.json`

## 故障排除

### FTP连接问题
1. **连接超时**:
   - 检查服务器IP地址是否正确
   - 确认网络连接正常
   - 检查防火墙设置

2. **认证失败**:
   - 验证用户名和密码
   - 确认FTP用户权限

3. **文件访问问题**:
   - 检查远程目录路径
   - 确认用户有读取权限

### 本地文件问题
1. **文件格式错误**:
   - 确保YAML文件格式正确
   - 检查PGM文件完整性

2. **路径问题**:
   - 确认文件路径正确
   - 检查文件读取权限

## 技术说明

### 支持的文件格式
- **地图文件**: YAML配置文件，自动关联PGM图像文件
- **虚拟墙文件**: JSON格式，包含线段坐标信息
- **区域文件**: JSON格式，包含多边形区域信息

### FTP特性
- 支持被动模式 (PASV)
- 自动断线重连
- 文件列表过滤 (只显示地图相关文件)
- 临时文件管理 (下载后自动清理)

### 性能优化
- 异步文件传输
- 进度状态更新
- UI响应性保护 