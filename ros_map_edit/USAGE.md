# ROS Map Edit 使用说明

## 快速开始

### 1. 启动系统
```bash
# 终端1: 启动roscore
roscore

# 终端2: 启动地图服务器
rosrun map_server map_server src/ros_map_edit/maps/sample_map.yaml

# 终端3: 启动RViz
rviz -d src/ros_map_edit/config/map_edit.rviz
```

### 2. 使用工具

## 🖤⚪ 黑白橡皮擦工具使用

### 简化操作
- **左键**: 直接画黑色 (添加障碍物)
- **右键**: 直接画白色 (清除障碍物)
- **拖拽**: 连续绘制
- **笔刷大小**: 在属性面板调节 (1-10像素)

### 实时显示
- 编辑后的地图会实时发布到 `/map_edited` 话题
- RViz中的"EditedMap"图层会显示修改后的效果
- 原始地图保持在"Map"图层显示

### 使用步骤
1. 在RViz工具栏选择 `MapEraserTool`
2. 在属性面板调整笔刷大小
3. 左键画黑色，右键画白色
4. 实时观察地图变化

## 🧱 虚拟墙工具使用

### 简化操作 (限制两点)
- **左键**: 点击第一个点
- **左键**: 点击第二个点 (自动完成墙体)
- **右键**: 取消当前墙体绘制

### 使用步骤
1. 选择 `VirtualWallTool`
2. 左键点击起始点
3. 左键点击结束点，墙体自动完成
4. 重复步骤2-3添加更多墙体

## 📐 区域工具使用

### 多边形绘制
- **左键**: 添加多边形顶点
- **右键**: 完成当前多边形
- **属性**: 可设置区域类型和参数

### 使用步骤
1. 选择 `RegionTool`
2. 在属性面板设置区域类型和参数
3. 左键依次点击多边形顶点
4. 右键完成多边形区域

## 💾 一键保存功能

### 新的保存方式
- **无需选择目录**: 直接保存到当前地图文件位置
- **无需命名**: 自动使用当前地图的文件名
- **一键完成**: 保存所有相关文件

### 使用步骤
1. 先通过"打开地图"加载一个基准地图文件
2. 使用各种工具编辑地图
3. 点击"一键保存所有文件"按钮
4. 文件自动保存到当前地图的同一目录

### 保存文件列表
- `map.yaml` - 地图配置文件
- `map.pgm` - 地图图像文件  
- `map.json` - 虚拟墙数据
- `map_region.json` - 区域数据

## 🔧 测试和调试

### 测试橡皮擦功能
```bash
# 运行测试脚本
./src/ros_map_edit/scripts/test_eraser.sh
```

### 检查话题
```bash
# 查看原始地图话题
rostopic info /map

# 查看编辑后地图话题
rostopic info /map_edited

# 监控地图修改
rostopic echo /map_edited -n 1
```

### 检查虚拟墙和区域
```bash
# 查看虚拟墙标记
rostopic echo /virtual_walls_markers -n 1

# 查看区域标记  
rostopic echo /region_markers -n 1
```

## 🐛 故障排除

### 橡皮擦不显示效果
1. 检查是否选择了正确的工具
2. 确认RViz中"EditedMap"图层已启用
3. 检查 `/map_edited` 话题是否有数据发布
4. 尝试调整笔刷大小

### 虚拟墙不显示
1. 确认"VirtualWalls"图层已启用
2. 检查 `/virtual_walls_markers` 话题
3. 确认已正确点击两个点

### 保存失败
1. 确认已先加载地图文件
2. 检查文件写入权限
3. 确认地图话题正在发布

### 地图不加载
1. 检查地图文件路径是否正确
2. 确认map_server正在运行
3. 验证YAML文件格式

## 💡 使用技巧

1. **笔刷大小**: 1-10像素范围，精细编辑用小笔刷
2. **图层管理**: 可以关闭原始地图图层，只显示编辑后的效果
3. **保存频率**: 经常保存，避免意外丢失编辑内容
4. **文件管理**: 编辑前备份原始地图文件

---
*最后更新: 2024年* 